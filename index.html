<html>
<head>
  <title>HowTheyVote.eu - Embeds</title>
  <meta name="robots" content="noindex">
</head>
<body>
  <button>Embed as Datawrapper chart</button>

  <script>
    const button = document.querySelector("button");

    button.addEventListener("click", async () => {
      const label = button.innerText;
      button.disabled = true;
      button.innerText = "Loading…";

      const formData = new FormData();
      
      formData.set("type", "tables");
      formData.set("title", "Motion of censure on the Commission");
      formData.set("description", (
        "Result of the vote in the European Parliament on July 10, 2025. " +
        "This vote was <b style='background:rgb(199, 30, 29);color:white;padding:1px 4px;'>rejected</b> " +
        "with <b style='border-bottom:rgb(0, 144, 118) 2px solid '>175 votes in favor</b>, " +
        "<b style='border-bottom:2px solid rgb(199, 30, 29);'>360 votes against</b>, " +
        "and <b style='border-bottom:2px solid rgb(29, 129, 162);'>18 abstentions</b>."
      ));
      formData.set("notes", "MEP photos © European Union 2025");
      formData.set("source_name", "HowTheyVote.eu (Open Database License)");
      formData.set("source_url", "https://howtheyvote.eu/votes/178149");
      formData.set("last_edit_step", "2");
      formData.set("metadata", JSON.stringify({
        "data": {
          "column-format": {
            "position": {
              "ignore": true,
            },
            "member.id": {
              "ignore": true,
            },
            "member.last_name": {
              "ignore": true,
            },
            "member.first_name": {
              "ignore": true,
            },
            "member.group.code": {
              "ignore": true,
            },
            "member.group.label": {
              "ignore": true,
            },
            "member.country.code": {
              "ignore": true,
            },
            "member.country.label": {
              "ignore": true,
            },
            "member.group.short_label": {
              "ignore": true,
            },
            "member.country.iso_alpha_2": {
              "ignore": true,
            }
          },
        },
        "describe": {
          "computed-columns": [
            {
              "name": "Photo",
              "formula": "CONCAT('![', memberfirst_name, '](', 'https://howtheyvote.eu/api/static/members/', memberid, '-104.jpg)')"
            },
            {
              "name": "MEP",
              "formula": `CONCAT(
                '<b>', memberfirst_name, ' ', memberlast_name, '</b><br />',
                '<span style="opacity:0.75">', membergroupshort_label, ' · ', membercountrylabel, '</span>'
              )`
            },
            {
              "name": "Vote",
              "formula": `CONCAT(
                IF(position == "VotePosition.FOR", "<b style='background:rgb(0, 144, 118); color:white; padding:1px 4px;'>For</b>", ""),
                IF(position == "VotePosition.AGAINST", "<b style='background:rgb(199, 30, 29); color:white; padding:1px 4px;'>Against</b>", ""),
                IF(position == "VotePosition.ABSTENTION", "<b style='background:rgb(29, 129, 162); color:white; padding:1px 4px'>Abstention</b>", ""),
                IF(position == "VotePosition.DID_NOT_VOTE", "<b style='background:rgb(114, 114, 114); color:white; padding:1px 4px'>Didn’t vote</b>", "")
              )`,
            }
          ]
        },
        "visualize": {
          "columns": {
            "Photo": {
              "style": {
                "fontSize": 3,
              },
              "fixedWidth": true,
              "width": 0.03,
            },
            "Vote": {
              "alignment": "right",
            },
          },
          "perPage": 10,
          "markdown": true,
          "noHeader": true,
          "pagination": {
            "enabled": true,
            "position": "both"
          },
          "searchable": true,
          "mobileFallback": true,
        },
        "publish": {
          "blocks": {
            "embed": true,
            "get-the-data": true,
          },
        },
      }));
      
      const dataUrl = "https://howtheyvote.eu/api/votes/178149.csv";

      const res = await fetch(dataUrl);
      const data = await res.text();
      formData.set("data", data);
      
      const form = document.createElement("form");
      form.target = "_blank";
      form.action = "https://app.datawrapper.de/create/";
      form.method = "POST";
      
      for (const [key, value] of formData.entries()) {
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = key;
        input.value = value;
        
        form.appendChild(input);
      }
      
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);

      button.disabled = false;
      button.innerText = label;
    });
  </script>
</body>